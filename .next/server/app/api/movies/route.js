"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/movies/route";
exports.ids = ["app/api/movies/route"];
exports.modules = {

/***/ "jsdom":
/*!************************!*\
  !*** external "jsdom" ***!
  \************************/
/***/ ((module) => {

module.exports = require("jsdom");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fmovies%2Froute&page=%2Fapi%2Fmovies%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmovies%2Froute.js&appDir=%2FUsers%2Fguzmancura%2FDesktop%2Fnextflix%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fguzmancura%2FDesktop%2Fnextflix&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fmovies%2Froute&page=%2Fapi%2Fmovies%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmovies%2Froute.js&appDir=%2FUsers%2Fguzmancura%2FDesktop%2Fnextflix%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fguzmancura%2FDesktop%2Fnextflix&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_guzmancura_Desktop_nextflix_src_app_api_movies_route_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/movies/route.js */ \"(rsc)/./src/app/api/movies/route.js\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/movies/route\",\n        pathname: \"/api/movies\",\n        filename: \"route\",\n        bundlePath: \"app/api/movies/route\"\n    },\n    resolvedPagePath: \"/Users/guzmancura/Desktop/nextflix/src/app/api/movies/route.js\",\n    nextConfigOutput,\n    userland: _Users_guzmancura_Desktop_nextflix_src_app_api_movies_route_js__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/movies/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZtb3ZpZXMlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRm1vdmllcyUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRm1vdmllcyUyRnJvdXRlLmpzJmFwcERpcj0lMkZVc2VycyUyRmd1em1hbmN1cmElMkZEZXNrdG9wJTJGbmV4dGZsaXglMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGZ3V6bWFuY3VyYSUyRkRlc2t0b3AlMkZuZXh0ZmxpeCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNjO0FBQzNGO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsdUdBQXVHO0FBQy9HO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDNko7O0FBRTdKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmV4dGZsaXgvP2VlNWMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL2d1em1hbmN1cmEvRGVza3RvcC9uZXh0ZmxpeC9zcmMvYXBwL2FwaS9tb3ZpZXMvcm91dGUuanNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL21vdmllcy9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL21vdmllc1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvbW92aWVzL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL2d1em1hbmN1cmEvRGVza3RvcC9uZXh0ZmxpeC9zcmMvYXBwL2FwaS9tb3ZpZXMvcm91dGUuanNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0IH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvbW92aWVzL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIGhlYWRlckhvb2tzLCBzdGF0aWNHZW5lcmF0aW9uQmFpbG91dCwgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fmovies%2Froute&page=%2Fapi%2Fmovies%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmovies%2Froute.js&appDir=%2FUsers%2Fguzmancura%2FDesktop%2Fnextflix%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fguzmancura%2FDesktop%2Fnextflix&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/movies/route.js":
/*!*************************************!*\
  !*** ./src/app/api/movies/route.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var jsdom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jsdom */ \"jsdom\");\n/* harmony import */ var jsdom__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jsdom__WEBPACK_IMPORTED_MODULE_1__);\n\n\nasync function fetchAllPages(listUrl) {\n    const allMovies = [];\n    let currentPage = 1;\n    let hasNextPage = true;\n    let retryCount = 0;\n    const maxRetries = 2;\n    const delayBetweenPages = 2000;\n    const delayBetweenRetries = 3000;\n    // Check if it's a watchlist URL\n    const isWatchlist = listUrl.includes(\"/watchlist\");\n    while(hasNextPage){\n        // Handle pagination URL format differently for watchlists\n        const pageUrl = currentPage === 1 ? listUrl : isWatchlist ? `${listUrl.replace(/\\/$/, \"\")}/page/${currentPage}/` : `${listUrl}page/${currentPage}/`;\n        console.log(\"Fetching page:\", pageUrl);\n        try {\n            if (currentPage > 1) {\n                console.log(`Waiting ${delayBetweenPages}ms before fetching next page...`);\n                await new Promise((resolve)=>setTimeout(resolve, delayBetweenPages));\n            }\n            const response = await fetch(pageUrl, {\n                headers: {\n                    \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36\",\n                    \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\",\n                    \"Accept-Language\": \"en-US,en;q=0.5\",\n                    \"Connection\": \"keep-alive\",\n                    \"Upgrade-Insecure-Requests\": \"1\",\n                    \"Cache-Control\": \"max-age=0\"\n                }\n            });\n            if (!response.ok) {\n                console.error(\"Failed to fetch page:\", pageUrl, response.status);\n                if (retryCount < maxRetries) {\n                    retryCount++;\n                    console.log(`Retrying page ${currentPage} (attempt ${retryCount}/${maxRetries})`);\n                    await new Promise((resolve)=>setTimeout(resolve, delayBetweenRetries));\n                    continue;\n                }\n                console.log(\"Max retries reached, continuing with available movies\");\n                break;\n            }\n            retryCount = 0;\n            const html = await response.text();\n            const dom = new jsdom__WEBPACK_IMPORTED_MODULE_1__.JSDOM(html);\n            const doc = dom.window.document;\n            // Try different selectors for movie elements\n            const movieElements = doc.querySelectorAll(\".poster-container, .film-poster\");\n            console.log(`Found ${movieElements.length} movies on page ${currentPage}`);\n            if (movieElements.length === 0) {\n                console.log(\"No movies found on page, breaking loop\");\n                break;\n            }\n            // Check if there's a next page by looking at the pagination\n            const pagination = doc.querySelector(\".paginate-pages, .pagination\");\n            console.log(\"Pagination element found:\", !!pagination);\n            if (pagination) {\n                const lastPageLink = pagination.querySelector(\"li:last-child a, .paginate-last a\");\n                const totalPages = lastPageLink ? parseInt(lastPageLink.textContent) : 1;\n                console.log(`Total pages found: ${totalPages}`);\n                hasNextPage = currentPage < totalPages;\n            } else {\n                // If no pagination found, check for next button\n                const nextButton = doc.querySelector(\".paginate-next, .next\");\n                console.log(\"Next button found:\", !!nextButton);\n                hasNextPage = !!nextButton;\n            }\n            // Add all movies from this page\n            allMovies.push(...Array.from(movieElements));\n            console.log(`Total movies collected so far: ${allMovies.length}`);\n            if (hasNextPage) {\n                console.log(`Moving to page ${currentPage + 1}`);\n                currentPage++;\n            }\n        } catch (error) {\n            console.error(\"Error fetching page:\", error);\n            if (retryCount < maxRetries) {\n                retryCount++;\n                console.log(`Retrying page ${currentPage} (attempt ${retryCount}/${maxRetries})`);\n                await new Promise((resolve)=>setTimeout(resolve, delayBetweenRetries));\n                continue;\n            }\n            console.log(\"Max retries reached, continuing with available movies\");\n            break;\n        }\n    }\n    console.log(`Finished fetching all pages. Total movies found: ${allMovies.length}`);\n    return allMovies;\n}\nasync function GET(request) {\n    try {\n        const { searchParams } = new URL(request.url);\n        const listUrl = searchParams.get(\"url\");\n        if (!listUrl) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Please provide a Letterboxd list URL\"\n            }, {\n                status: 400\n            });\n        }\n        console.log(\"Fetching list:\", listUrl);\n        const movieElements = await fetchAllPages(listUrl);\n        console.log(\"Total movie elements found across all pages:\", movieElements.length);\n        if (movieElements.length === 0) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"No movies found in the list. Please make sure the list is public and accessible.\"\n            }, {\n                status: 404\n            });\n        }\n        const movies = await Promise.all(movieElements.map(async (element, index)=>{\n            const movieLink = element.querySelector(\"div[data-target-link]\");\n            const movieSlug = movieLink?.getAttribute(\"data-target-link\")?.split(\"/\")[2] || \"\";\n            if (!movieSlug) {\n                console.log(\"No movie slug found for element:\", element.outerHTML);\n                return null;\n            }\n            console.log(\"Processing movie with slug:\", movieSlug);\n            try {\n                const movieUrl = `https://letterboxd.com/film/${movieSlug}/`;\n                console.log(\"Fetching movie:\", movieUrl);\n                const movieResponse = await fetch(movieUrl, {\n                    headers: {\n                        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36\",\n                        \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\",\n                        \"Accept-Language\": \"en-US,en;q=0.5\",\n                        \"Connection\": \"keep-alive\",\n                        \"Upgrade-Insecure-Requests\": \"1\",\n                        \"Cache-Control\": \"max-age=0\"\n                    }\n                });\n                if (!movieResponse.ok) {\n                    console.error(\"Failed to fetch movie:\", movieUrl, movieResponse.status);\n                    return null;\n                }\n                const movieHtml = await movieResponse.text();\n                const movieDom = new jsdom__WEBPACK_IMPORTED_MODULE_1__.JSDOM(movieHtml);\n                const movieDoc = movieDom.window.document;\n                const titleElement = movieDoc.querySelector(\"h1.headline-1\");\n                const title1 = titleElement?.textContent?.trim() || movieSlug.replace(/-/g, \" \");\n                const tmdbLink = movieDoc.querySelector('a[href*=\"themoviedb.org\"]');\n                const tmdbId = tmdbLink?.href?.match(/movie\\/(\\d+)/)?.[1];\n                console.log(\"Movie processing:\", {\n                    title: title1,\n                    tmdbId,\n                    hasTmdbLink: !!tmdbLink,\n                    tmdbLinkHref: tmdbLink?.href\n                });\n                const letterboxdApiUrl = `https://letterboxd.com/film/${movieSlug}/`;\n                console.log(\"Fetching reviews from:\", letterboxdApiUrl);\n                let reviews = [];\n                try {\n                    const reviewsResponse = await fetch(letterboxdApiUrl, {\n                        headers: {\n                            \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36\",\n                            \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\",\n                            \"Accept-Language\": \"en-US,en;q=0.5\",\n                            \"Connection\": \"keep-alive\",\n                            \"Upgrade-Insecure-Requests\": \"1\",\n                            \"Cache-Control\": \"max-age=0\"\n                        }\n                    });\n                    console.log(\"Reviews response status:\", reviewsResponse.status);\n                    console.log(\"Reviews response ok:\", reviewsResponse.ok);\n                    if (reviewsResponse.ok) {\n                        const reviewsHtml = await reviewsResponse.text();\n                        const reviewsDom = new jsdom__WEBPACK_IMPORTED_MODULE_1__.JSDOM(reviewsHtml);\n                        const reviewsDoc = reviewsDom.window.document;\n                        // Find the Popular Reviews section and get its AJAX URL\n                        const popularReviewsSection = reviewsDoc.querySelector(\".js-popular-reviews\");\n                        console.log(\"Popular reviews section found:\", !!popularReviewsSection);\n                        if (popularReviewsSection) {\n                            const reviewsUrl = popularReviewsSection.getAttribute(\"data-url\");\n                            console.log(\"Found reviews URL:\", reviewsUrl);\n                            if (reviewsUrl) {\n                                // Fetch the reviews from the AJAX endpoint\n                                const ajaxReviewsResponse = await fetch(`https://letterboxd.com${reviewsUrl}`, {\n                                    headers: {\n                                        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36\",\n                                        \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\",\n                                        \"Accept-Language\": \"en-US,en;q=0.5\",\n                                        \"Connection\": \"keep-alive\",\n                                        \"X-Requested-With\": \"XMLHttpRequest\"\n                                    }\n                                });\n                                if (ajaxReviewsResponse.ok) {\n                                    const ajaxReviewsHtml = await ajaxReviewsResponse.text();\n                                    const ajaxReviewsDom = new jsdom__WEBPACK_IMPORTED_MODULE_1__.JSDOM(ajaxReviewsHtml);\n                                    const ajaxReviewsDoc = ajaxReviewsDom.window.document;\n                                    const reviewContainers = ajaxReviewsDoc.querySelectorAll(\".js-listitem\");\n                                    console.log(\"Found review containers:\", reviewContainers.length);\n                                    if (reviewContainers.length > 0) {\n                                        reviews = Array.from(reviewContainers).map((container)=>{\n                                            const reviewText = container.querySelector(\".js-review-body\")?.textContent?.trim() || \"\";\n                                            const reviewerName = container.querySelector(\".displayname\")?.textContent?.trim() || \"Anonymous\";\n                                            const ratingElement = container.querySelector(\".rating\");\n                                            const rating = ratingElement ? ratingElement.textContent.includes(\"★\") ? ratingElement.textContent.split(\"★\").length - 1 : 0 : 0;\n                                            const dateElement = container.querySelector(\"time\");\n                                            const date = dateElement?.getAttribute(\"datetime\") || new Date().toISOString();\n                                            const avatarElement = container.querySelector(\".avatar img\");\n                                            const avatarUrl = avatarElement?.src || null;\n                                            console.log(\"Processing review:\", {\n                                                reviewer: reviewerName,\n                                                hasContent: !!reviewText,\n                                                contentLength: reviewText.length,\n                                                rating,\n                                                date,\n                                                hasAvatar: !!avatarUrl\n                                            });\n                                            return {\n                                                id: container?.querySelector(\".js-production-viewing\")?.getAttribute(\"data-viewing-id\") || Math.random().toString(36).substr(2, 9),\n                                                reviewer: reviewerName,\n                                                rating,\n                                                date,\n                                                content: reviewText,\n                                                profilePath: avatarUrl\n                                            };\n                                        }).filter((review)=>review.content.length > 0);\n                                        reviews.sort((a, b)=>new Date(b.date) - new Date(a.date));\n                                        reviews = reviews.slice(0, 6);\n                                        console.log(\"Final processed reviews:\", reviews.length);\n                                    }\n                                }\n                            }\n                        }\n                    }\n                } catch (error) {\n                    console.error(\"Error fetching reviews:\", error);\n                }\n                let movieData = {\n                    id: index + 1,\n                    title: title1.charAt(0).toUpperCase() + title1.slice(1),\n                    year: null,\n                    director: \"Unknown Director\",\n                    directorProfilePath: null,\n                    posterUrl: \"https://s.ltrbxd.com/static/img/empty-poster-1000-D9cprv0m.png\",\n                    description: \"No description available\",\n                    rating: null,\n                    genres: [],\n                    cast: [],\n                    backdropUrl: null,\n                    runtime: null,\n                    releaseDate: null,\n                    tmdbId: null,\n                    movieSlug,\n                    reviews: reviews || []\n                };\n                if (tmdbId) {\n                    console.log(\"Fetching data for movie with TMDB ID:\", tmdbId);\n                    const tmdbUrl = `https://api.themoviedb.org/3/movie/${tmdbId}?api_key=2dca580c2a14b55200e784d157207b4d&append_to_response=credits`;\n                    console.log(\"Fetching movie details from:\", tmdbUrl);\n                    const tmdbResponse = await fetch(tmdbUrl, {\n                        headers: {\n                            \"Accept\": \"application/json\"\n                        }\n                    });\n                    if (tmdbResponse.ok) {\n                        const tmdbData = await tmdbResponse.json();\n                        console.log(\"TMDB movie data received:\", {\n                            title: tmdbData.title,\n                            hasCredits: !!tmdbData.credits,\n                            responseKeys: Object.keys(tmdbData)\n                        });\n                        const year = tmdbData.release_date?.split(\"-\")[0] || \"\";\n                        const directorData = tmdbData.credits?.crew?.find((person)=>person.job === \"Director\");\n                        const director = directorData?.name || \"Unknown Director\";\n                        const directorProfilePath = directorData?.profile_path ? `https://image.tmdb.org/t/p/w185${directorData.profile_path}` : null;\n                        const cast = tmdbData.credits?.cast?.map((actor)=>({\n                                name: actor.name,\n                                character: actor.character,\n                                profilePath: actor.profile_path ? `https://image.tmdb.org/t/p/w185${actor.profile_path}` : null,\n                                order: actor.order\n                            })).sort((a, b)=>a.order - b.order) || [];\n                        let description = \"No description available\";\n                        if (tmdbData.overview) {\n                            description = tmdbData.overview;\n                        } else {\n                            const letterboxdDescription = movieDoc.querySelector(\".text-sluglist + p, .text-sluglist + div p\");\n                            if (letterboxdDescription) {\n                                description = letterboxdDescription.textContent.trim();\n                            }\n                        }\n                        const rating = tmdbData.vote_average ? Math.round(tmdbData.vote_average * 10) / 10 : null;\n                        const genres = tmdbData.genres?.map((genre)=>genre.name) || [];\n                        const posterUrl = tmdbData.poster_path ? `https://image.tmdb.org/t/p/w500${tmdbData.poster_path}` : \"https://s.ltrbxd.com/static/img/empty-poster-1000-D9cprv0m.png\";\n                        const backdropUrl = tmdbData.backdrop_path ? `https://image.tmdb.org/t/p/original${tmdbData.backdrop_path}` : null;\n                        movieData = {\n                            ...movieData,\n                            year: parseInt(year) || null,\n                            director,\n                            directorProfilePath,\n                            posterUrl,\n                            description,\n                            rating,\n                            genres,\n                            cast,\n                            backdropUrl,\n                            runtime: tmdbData.runtime,\n                            releaseDate: tmdbData.release_date,\n                            tmdbId\n                        };\n                    }\n                }\n                console.log(\"Final movie data:\", movieData);\n                return movieData;\n            } catch (error) {\n                console.error(\"Error processing movie:\", movieSlug, error);\n                return {\n                    id: index + 1,\n                    title: title.charAt(0).toUpperCase() + title.slice(1),\n                    year: null,\n                    director: \"Unknown Director\",\n                    directorProfilePath: null,\n                    posterUrl: \"https://s.ltrbxd.com/static/img/empty-poster-1000-D9cprv0m.png\",\n                    description: \"No description available\",\n                    rating: null,\n                    genres: [],\n                    cast: [],\n                    backdropUrl: null,\n                    runtime: null,\n                    releaseDate: null,\n                    tmdbId: null,\n                    movieSlug,\n                    reviews: []\n                };\n            }\n        }));\n        const validMovies = movies.filter((movie)=>movie !== null);\n        const uniqueMovies = Array.from(new Map(validMovies.map((movie)=>[\n                movie.title,\n                movie\n            ])).values());\n        console.log(\"Final movies array:\", uniqueMovies.map((m)=>({\n                title: m.title,\n                slug: m.movieSlug\n            })));\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(uniqueMovies);\n    } catch (error) {\n        console.error(\"Error in API route:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: error.message || \"An unexpected error occurred\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9tb3ZpZXMvcm91dGUuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUEyQztBQUNiO0FBRTlCLGVBQWVFLGNBQWNDLE9BQU87SUFDbEMsTUFBTUMsWUFBWSxFQUFFO0lBQ3BCLElBQUlDLGNBQWM7SUFDbEIsSUFBSUMsY0FBYztJQUNsQixJQUFJQyxhQUFhO0lBQ2pCLE1BQU1DLGFBQWE7SUFDbkIsTUFBTUMsb0JBQW9CO0lBQzFCLE1BQU1DLHNCQUFzQjtJQUU1QixnQ0FBZ0M7SUFDaEMsTUFBTUMsY0FBY1IsUUFBUVMsUUFBUSxDQUFDO0lBRXJDLE1BQU9OLFlBQWE7UUFDbEIsMERBQTBEO1FBQzFELE1BQU1PLFVBQVVSLGdCQUFnQixJQUM1QkYsVUFDQVEsY0FDRSxDQUFDLEVBQUVSLFFBQVFXLE9BQU8sQ0FBQyxPQUFPLElBQUksTUFBTSxFQUFFVCxZQUFZLENBQUMsQ0FBQyxHQUNwRCxDQUFDLEVBQUVGLFFBQVEsS0FBSyxFQUFFRSxZQUFZLENBQUMsQ0FBQztRQUV0Q1UsUUFBUUMsR0FBRyxDQUFDLGtCQUFrQkg7UUFFOUIsSUFBSTtZQUNGLElBQUlSLGNBQWMsR0FBRztnQkFDbkJVLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsRUFBRVAsa0JBQWtCLCtCQUErQixDQUFDO2dCQUN6RSxNQUFNLElBQUlRLFFBQVFDLENBQUFBLFVBQVdDLFdBQVdELFNBQVNUO1lBQ25EO1lBRUEsTUFBTVcsV0FBVyxNQUFNQyxNQUFNUixTQUFTO2dCQUNwQ1MsU0FBUztvQkFDUCxjQUFjO29CQUNkLFVBQVU7b0JBQ1YsbUJBQW1CO29CQUNuQixjQUFjO29CQUNkLDZCQUE2QjtvQkFDN0IsaUJBQWlCO2dCQUNuQjtZQUNGO1lBRUEsSUFBSSxDQUFDRixTQUFTRyxFQUFFLEVBQUU7Z0JBQ2hCUixRQUFRUyxLQUFLLENBQUMseUJBQXlCWCxTQUFTTyxTQUFTSyxNQUFNO2dCQUMvRCxJQUFJbEIsYUFBYUMsWUFBWTtvQkFDM0JEO29CQUNBUSxRQUFRQyxHQUFHLENBQUMsQ0FBQyxjQUFjLEVBQUVYLFlBQVksVUFBVSxFQUFFRSxXQUFXLENBQUMsRUFBRUMsV0FBVyxDQUFDLENBQUM7b0JBQ2hGLE1BQU0sSUFBSVMsUUFBUUMsQ0FBQUEsVUFBV0MsV0FBV0QsU0FBU1I7b0JBQ2pEO2dCQUNGO2dCQUNBSyxRQUFRQyxHQUFHLENBQUM7Z0JBQ1o7WUFDRjtZQUVBVCxhQUFhO1lBQ2IsTUFBTW1CLE9BQU8sTUFBTU4sU0FBU08sSUFBSTtZQUNoQyxNQUFNQyxNQUFNLElBQUkzQix3Q0FBS0EsQ0FBQ3lCO1lBQ3RCLE1BQU1HLE1BQU1ELElBQUlFLE1BQU0sQ0FBQ0MsUUFBUTtZQUUvQiw2Q0FBNkM7WUFDN0MsTUFBTUMsZ0JBQWdCSCxJQUFJSSxnQkFBZ0IsQ0FBQztZQUMzQ2xCLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRWdCLGNBQWNFLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRTdCLFlBQVksQ0FBQztZQUV6RSxJQUFJMkIsY0FBY0UsTUFBTSxLQUFLLEdBQUc7Z0JBQzlCbkIsUUFBUUMsR0FBRyxDQUFDO2dCQUNaO1lBQ0Y7WUFFQSw0REFBNEQ7WUFDNUQsTUFBTW1CLGFBQWFOLElBQUlPLGFBQWEsQ0FBQztZQUNyQ3JCLFFBQVFDLEdBQUcsQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDbUI7WUFFM0MsSUFBSUEsWUFBWTtnQkFDZCxNQUFNRSxlQUFlRixXQUFXQyxhQUFhLENBQUM7Z0JBQzlDLE1BQU1FLGFBQWFELGVBQWVFLFNBQVNGLGFBQWFHLFdBQVcsSUFBSTtnQkFDdkV6QixRQUFRQyxHQUFHLENBQUMsQ0FBQyxtQkFBbUIsRUFBRXNCLFdBQVcsQ0FBQztnQkFDOUNoQyxjQUFjRCxjQUFjaUM7WUFDOUIsT0FBTztnQkFDTCxnREFBZ0Q7Z0JBQ2hELE1BQU1HLGFBQWFaLElBQUlPLGFBQWEsQ0FBQztnQkFDckNyQixRQUFRQyxHQUFHLENBQUMsc0JBQXNCLENBQUMsQ0FBQ3lCO2dCQUNwQ25DLGNBQWMsQ0FBQyxDQUFDbUM7WUFDbEI7WUFFQSxnQ0FBZ0M7WUFDaENyQyxVQUFVc0MsSUFBSSxJQUFJQyxNQUFNQyxJQUFJLENBQUNaO1lBQzdCakIsUUFBUUMsR0FBRyxDQUFDLENBQUMsK0JBQStCLEVBQUVaLFVBQVU4QixNQUFNLENBQUMsQ0FBQztZQUVoRSxJQUFJNUIsYUFBYTtnQkFDZlMsUUFBUUMsR0FBRyxDQUFDLENBQUMsZUFBZSxFQUFFWCxjQUFjLEVBQUUsQ0FBQztnQkFDL0NBO1lBQ0Y7UUFDRixFQUFFLE9BQU9tQixPQUFPO1lBQ2RULFFBQVFTLEtBQUssQ0FBQyx3QkFBd0JBO1lBQ3RDLElBQUlqQixhQUFhQyxZQUFZO2dCQUMzQkQ7Z0JBQ0FRLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLGNBQWMsRUFBRVgsWUFBWSxVQUFVLEVBQUVFLFdBQVcsQ0FBQyxFQUFFQyxXQUFXLENBQUMsQ0FBQztnQkFDaEYsTUFBTSxJQUFJUyxRQUFRQyxDQUFBQSxVQUFXQyxXQUFXRCxTQUFTUjtnQkFDakQ7WUFDRjtZQUNBSyxRQUFRQyxHQUFHLENBQUM7WUFDWjtRQUNGO0lBQ0Y7SUFFQUQsUUFBUUMsR0FBRyxDQUFDLENBQUMsaURBQWlELEVBQUVaLFVBQVU4QixNQUFNLENBQUMsQ0FBQztJQUNsRixPQUFPOUI7QUFDVDtBQUVPLGVBQWV5QyxJQUFJQyxPQUFPO0lBQy9CLElBQUk7UUFDRixNQUFNLEVBQUVDLFlBQVksRUFBRSxHQUFHLElBQUlDLElBQUlGLFFBQVFHLEdBQUc7UUFDNUMsTUFBTTlDLFVBQVU0QyxhQUFhRyxHQUFHLENBQUM7UUFFakMsSUFBSSxDQUFDL0MsU0FBUztZQUNaLE9BQU9ILHFEQUFZQSxDQUFDbUQsSUFBSSxDQUN0QjtnQkFBRTNCLE9BQU87WUFBdUMsR0FDaEQ7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBVixRQUFRQyxHQUFHLENBQUMsa0JBQWtCYjtRQUU5QixNQUFNNkIsZ0JBQWdCLE1BQU05QixjQUFjQztRQUMxQ1ksUUFBUUMsR0FBRyxDQUFDLGdEQUFnRGdCLGNBQWNFLE1BQU07UUFFaEYsSUFBSUYsY0FBY0UsTUFBTSxLQUFLLEdBQUc7WUFDOUIsT0FBT2xDLHFEQUFZQSxDQUFDbUQsSUFBSSxDQUN0QjtnQkFBRTNCLE9BQU87WUFBbUYsR0FDNUY7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLE1BQU0yQixTQUFTLE1BQU1uQyxRQUFRb0MsR0FBRyxDQUFDckIsY0FBY3NCLEdBQUcsQ0FBQyxPQUFPQyxTQUFTQztZQUNqRSxNQUFNQyxZQUFZRixRQUFRbkIsYUFBYSxDQUFDO1lBQ3hDLE1BQU1zQixZQUFZRCxXQUFXRSxhQUFhLHFCQUFxQkMsTUFBTSxJQUFJLENBQUMsRUFBRSxJQUFJO1lBRWhGLElBQUksQ0FBQ0YsV0FBVztnQkFDZDNDLFFBQVFDLEdBQUcsQ0FBQyxvQ0FBb0N1QyxRQUFRTSxTQUFTO2dCQUNqRSxPQUFPO1lBQ1Q7WUFFQTlDLFFBQVFDLEdBQUcsQ0FBQywrQkFBK0IwQztZQUUzQyxJQUFJO2dCQUNGLE1BQU1JLFdBQVcsQ0FBQyw0QkFBNEIsRUFBRUosVUFBVSxDQUFDLENBQUM7Z0JBQzVEM0MsUUFBUUMsR0FBRyxDQUFDLG1CQUFtQjhDO2dCQUUvQixNQUFNQyxnQkFBZ0IsTUFBTTFDLE1BQU15QyxVQUFVO29CQUMxQ3hDLFNBQVM7d0JBQ1AsY0FBYzt3QkFDZCxVQUFVO3dCQUNWLG1CQUFtQjt3QkFDbkIsY0FBYzt3QkFDZCw2QkFBNkI7d0JBQzdCLGlCQUFpQjtvQkFDbkI7Z0JBQ0Y7Z0JBRUEsSUFBSSxDQUFDeUMsY0FBY3hDLEVBQUUsRUFBRTtvQkFDckJSLFFBQVFTLEtBQUssQ0FBQywwQkFBMEJzQyxVQUFVQyxjQUFjdEMsTUFBTTtvQkFDdEUsT0FBTztnQkFDVDtnQkFFQSxNQUFNdUMsWUFBWSxNQUFNRCxjQUFjcEMsSUFBSTtnQkFDMUMsTUFBTXNDLFdBQVcsSUFBSWhFLHdDQUFLQSxDQUFDK0Q7Z0JBQzNCLE1BQU1FLFdBQVdELFNBQVNuQyxNQUFNLENBQUNDLFFBQVE7Z0JBRXpDLE1BQU1vQyxlQUFlRCxTQUFTOUIsYUFBYSxDQUFDO2dCQUM1QyxNQUFNZ0MsU0FBUUQsY0FBYzNCLGFBQWE2QixVQUFVWCxVQUFVNUMsT0FBTyxDQUFDLE1BQU07Z0JBRTNFLE1BQU13RCxXQUFXSixTQUFTOUIsYUFBYSxDQUFDO2dCQUN4QyxNQUFNbUMsU0FBU0QsVUFBVUUsTUFBTUMsTUFBTSxpQkFBaUIsQ0FBQyxFQUFFO2dCQUV6RDFELFFBQVFDLEdBQUcsQ0FBQyxxQkFBcUI7b0JBQy9Cb0QsT0FBQUE7b0JBQ0FHO29CQUNBRyxhQUFhLENBQUMsQ0FBQ0o7b0JBQ2ZLLGNBQWNMLFVBQVVFO2dCQUMxQjtnQkFFQSxNQUFNSSxtQkFBbUIsQ0FBQyw0QkFBNEIsRUFBRWxCLFVBQVUsQ0FBQyxDQUFDO2dCQUNwRTNDLFFBQVFDLEdBQUcsQ0FBQywwQkFBMEI0RDtnQkFFdEMsSUFBSUMsVUFBVSxFQUFFO2dCQUNoQixJQUFJO29CQUNGLE1BQU1DLGtCQUFrQixNQUFNekQsTUFBTXVELGtCQUFrQjt3QkFDcER0RCxTQUFTOzRCQUNQLGNBQWM7NEJBQ2QsVUFBVTs0QkFDVixtQkFBbUI7NEJBQ25CLGNBQWM7NEJBQ2QsNkJBQTZCOzRCQUM3QixpQkFBaUI7d0JBQ25CO29CQUNGO29CQUVBUCxRQUFRQyxHQUFHLENBQUMsNEJBQTRCOEQsZ0JBQWdCckQsTUFBTTtvQkFDOURWLFFBQVFDLEdBQUcsQ0FBQyx3QkFBd0I4RCxnQkFBZ0J2RCxFQUFFO29CQUV0RCxJQUFJdUQsZ0JBQWdCdkQsRUFBRSxFQUFFO3dCQUN0QixNQUFNd0QsY0FBYyxNQUFNRCxnQkFBZ0JuRCxJQUFJO3dCQUM5QyxNQUFNcUQsYUFBYSxJQUFJL0Usd0NBQUtBLENBQUM4RTt3QkFDN0IsTUFBTUUsYUFBYUQsV0FBV2xELE1BQU0sQ0FBQ0MsUUFBUTt3QkFFN0Msd0RBQXdEO3dCQUN4RCxNQUFNbUQsd0JBQXdCRCxXQUFXN0MsYUFBYSxDQUFDO3dCQUN2RHJCLFFBQVFDLEdBQUcsQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDa0U7d0JBRWhELElBQUlBLHVCQUF1Qjs0QkFDekIsTUFBTUMsYUFBYUQsc0JBQXNCdkIsWUFBWSxDQUFDOzRCQUN0RDVDLFFBQVFDLEdBQUcsQ0FBQyxzQkFBc0JtRTs0QkFFbEMsSUFBSUEsWUFBWTtnQ0FDZCwyQ0FBMkM7Z0NBQzNDLE1BQU1DLHNCQUFzQixNQUFNL0QsTUFBTSxDQUFDLHNCQUFzQixFQUFFOEQsV0FBVyxDQUFDLEVBQUU7b0NBQzdFN0QsU0FBUzt3Q0FDUCxjQUFjO3dDQUNkLFVBQVU7d0NBQ1YsbUJBQW1CO3dDQUNuQixjQUFjO3dDQUNkLG9CQUFvQjtvQ0FDdEI7Z0NBQ0Y7Z0NBRUEsSUFBSThELG9CQUFvQjdELEVBQUUsRUFBRTtvQ0FDMUIsTUFBTThELGtCQUFrQixNQUFNRCxvQkFBb0J6RCxJQUFJO29DQUN0RCxNQUFNMkQsaUJBQWlCLElBQUlyRix3Q0FBS0EsQ0FBQ29GO29DQUNqQyxNQUFNRSxpQkFBaUJELGVBQWV4RCxNQUFNLENBQUNDLFFBQVE7b0NBRXJELE1BQU15RCxtQkFBbUJELGVBQWV0RCxnQkFBZ0IsQ0FBQztvQ0FDekRsQixRQUFRQyxHQUFHLENBQUMsNEJBQTRCd0UsaUJBQWlCdEQsTUFBTTtvQ0FFL0QsSUFBSXNELGlCQUFpQnRELE1BQU0sR0FBRyxHQUFHO3dDQUMvQjJDLFVBQVVsQyxNQUFNQyxJQUFJLENBQUM0QyxrQkFDbEJsQyxHQUFHLENBQUNtQyxDQUFBQTs0Q0FDSCxNQUFNQyxhQUFhRCxVQUFVckQsYUFBYSxDQUFDLG9CQUFvQkksYUFBYTZCLFVBQVU7NENBQ3RGLE1BQU1zQixlQUFlRixVQUFVckQsYUFBYSxDQUFDLGlCQUFpQkksYUFBYTZCLFVBQVU7NENBQ3JGLE1BQU11QixnQkFBZ0JILFVBQVVyRCxhQUFhLENBQUM7NENBQzlDLE1BQU15RCxTQUFTRCxnQkFDWkEsY0FBY3BELFdBQVcsQ0FBQzVCLFFBQVEsQ0FBQyxPQUNsQ2dGLGNBQWNwRCxXQUFXLENBQUNvQixLQUFLLENBQUMsS0FBSzFCLE1BQU0sR0FBRyxJQUFJLElBQUs7NENBQzNELE1BQU00RCxjQUFjTCxVQUFVckQsYUFBYSxDQUFDOzRDQUM1QyxNQUFNMkQsT0FBT0QsYUFBYW5DLGFBQWEsZUFBZSxJQUFJcUMsT0FBT0MsV0FBVzs0Q0FDNUUsTUFBTUMsZ0JBQWdCVCxVQUFVckQsYUFBYSxDQUFDOzRDQUM5QyxNQUFNK0QsWUFBWUQsZUFBZUUsT0FBTzs0Q0FFeENyRixRQUFRQyxHQUFHLENBQUMsc0JBQXNCO2dEQUNoQ3FGLFVBQVVWO2dEQUNWVyxZQUFZLENBQUMsQ0FBQ1o7Z0RBQ2RhLGVBQWViLFdBQVd4RCxNQUFNO2dEQUNoQzJEO2dEQUNBRTtnREFDQVMsV0FBVyxDQUFDLENBQUNMOzRDQUNmOzRDQUVBLE9BQU87Z0RBQ0xNLElBQUloQixXQUFXckQsY0FBYywyQkFBMkJ1QixhQUFhLHNCQUFzQitDLEtBQUtDLE1BQU0sR0FBR0MsUUFBUSxDQUFDLElBQUlDLE1BQU0sQ0FBQyxHQUFHO2dEQUNoSVIsVUFBVVY7Z0RBQ1ZFO2dEQUNBRTtnREFDQWUsU0FBU3BCO2dEQUNUcUIsYUFBYVo7NENBQ2Y7d0NBQ0YsR0FDQ2EsTUFBTSxDQUFDQyxDQUFBQSxTQUFVQSxPQUFPSCxPQUFPLENBQUM1RSxNQUFNLEdBQUc7d0NBRTVDMkMsUUFBUXFDLElBQUksQ0FBQyxDQUFDQyxHQUFHQyxJQUFNLElBQUlwQixLQUFLb0IsRUFBRXJCLElBQUksSUFBSSxJQUFJQyxLQUFLbUIsRUFBRXBCLElBQUk7d0NBQ3pEbEIsVUFBVUEsUUFBUXdDLEtBQUssQ0FBQyxHQUFHO3dDQUMzQnRHLFFBQVFDLEdBQUcsQ0FBQyw0QkFBNEI2RCxRQUFRM0MsTUFBTTtvQ0FDeEQ7Z0NBQ0Y7NEJBQ0Y7d0JBQ0Y7b0JBQ0Y7Z0JBQ0YsRUFBRSxPQUFPVixPQUFPO29CQUNkVCxRQUFRUyxLQUFLLENBQUMsMkJBQTJCQTtnQkFDM0M7Z0JBRUEsSUFBSThGLFlBQVk7b0JBQ2RiLElBQUlqRCxRQUFRO29CQUNaWSxPQUFPQSxPQUFNbUQsTUFBTSxDQUFDLEdBQUdDLFdBQVcsS0FBS3BELE9BQU1pRCxLQUFLLENBQUM7b0JBQ25ESSxNQUFNO29CQUNOQyxVQUFVO29CQUNWQyxxQkFBcUI7b0JBQ3JCQyxXQUFXO29CQUNYQyxhQUFhO29CQUNiaEMsUUFBUTtvQkFDUmlDLFFBQVEsRUFBRTtvQkFDVkMsTUFBTSxFQUFFO29CQUNSQyxhQUFhO29CQUNiQyxTQUFTO29CQUNUQyxhQUFhO29CQUNiM0QsUUFBUTtvQkFDUmI7b0JBQ0FtQixTQUFTQSxXQUFXLEVBQUU7Z0JBQ3hCO2dCQUVBLElBQUlOLFFBQVE7b0JBQ1Z4RCxRQUFRQyxHQUFHLENBQUMseUNBQXlDdUQ7b0JBRXJELE1BQU00RCxVQUFVLENBQUMsbUNBQW1DLEVBQUU1RCxPQUFPLG9FQUFvRSxDQUFDO29CQUNsSXhELFFBQVFDLEdBQUcsQ0FBQyxnQ0FBZ0NtSDtvQkFFNUMsTUFBTUMsZUFBZSxNQUFNL0csTUFBTThHLFNBQVM7d0JBQ3hDN0csU0FBUzs0QkFDUCxVQUFVO3dCQUNaO29CQUNGO29CQUVBLElBQUk4RyxhQUFhN0csRUFBRSxFQUFFO3dCQUNuQixNQUFNOEcsV0FBVyxNQUFNRCxhQUFhakYsSUFBSTt3QkFDeENwQyxRQUFRQyxHQUFHLENBQUMsNkJBQTZCOzRCQUN2Q29ELE9BQU9pRSxTQUFTakUsS0FBSzs0QkFDckJrRSxZQUFZLENBQUMsQ0FBQ0QsU0FBU0UsT0FBTzs0QkFDOUJDLGNBQWNDLE9BQU9DLElBQUksQ0FBQ0w7d0JBQzVCO3dCQUVBLE1BQU1aLE9BQU9ZLFNBQVNNLFlBQVksRUFBRS9FLE1BQU0sSUFBSSxDQUFDLEVBQUUsSUFBSTt3QkFFckQsTUFBTWdGLGVBQWVQLFNBQVNFLE9BQU8sRUFBRU0sTUFBTUMsS0FBS0MsQ0FBQUEsU0FBVUEsT0FBT0MsR0FBRyxLQUFLO3dCQUMzRSxNQUFNdEIsV0FBV2tCLGNBQWNLLFFBQVE7d0JBQ3ZDLE1BQU10QixzQkFBc0JpQixjQUFjTSxlQUN0QyxDQUFDLCtCQUErQixFQUFFTixhQUFhTSxZQUFZLENBQUMsQ0FBQyxHQUM3RDt3QkFFSixNQUFNbkIsT0FBT00sU0FBU0UsT0FBTyxFQUFFUixNQUMzQnpFLElBQUk2RixDQUFBQSxRQUFVO2dDQUNkRixNQUFNRSxNQUFNRixJQUFJO2dDQUNoQkcsV0FBV0QsTUFBTUMsU0FBUztnQ0FDMUJyQyxhQUFhb0MsTUFBTUQsWUFBWSxHQUMzQixDQUFDLCtCQUErQixFQUFFQyxNQUFNRCxZQUFZLENBQUMsQ0FBQyxHQUN0RDtnQ0FDSkcsT0FBT0YsTUFBTUUsS0FBSzs0QkFDcEIsSUFDQ25DLEtBQUssQ0FBQ0MsR0FBR0MsSUFBTUQsRUFBRWtDLEtBQUssR0FBR2pDLEVBQUVpQyxLQUFLLEtBQUssRUFBRTt3QkFFMUMsSUFBSXhCLGNBQWM7d0JBQ2xCLElBQUlRLFNBQVNpQixRQUFRLEVBQUU7NEJBQ3JCekIsY0FBY1EsU0FBU2lCLFFBQVE7d0JBQ2pDLE9BQU87NEJBQ0wsTUFBTUMsd0JBQXdCckYsU0FBUzlCLGFBQWEsQ0FBQzs0QkFDckQsSUFBSW1ILHVCQUF1QjtnQ0FDekIxQixjQUFjMEIsc0JBQXNCL0csV0FBVyxDQUFDNkIsSUFBSTs0QkFDdEQ7d0JBQ0Y7d0JBRUEsTUFBTXdCLFNBQVN3QyxTQUFTbUIsWUFBWSxHQUNoQzlDLEtBQUsrQyxLQUFLLENBQUNwQixTQUFTbUIsWUFBWSxHQUFHLE1BQU0sS0FDekM7d0JBRUosTUFBTTFCLFNBQVNPLFNBQVNQLE1BQU0sRUFBRXhFLElBQUlvRyxDQUFBQSxRQUFTQSxNQUFNVCxJQUFJLEtBQUssRUFBRTt3QkFFOUQsTUFBTXJCLFlBQVlTLFNBQVNzQixXQUFXLEdBQ2xDLENBQUMsK0JBQStCLEVBQUV0QixTQUFTc0IsV0FBVyxDQUFDLENBQUMsR0FDeEQ7d0JBRUosTUFBTTNCLGNBQWNLLFNBQVN1QixhQUFhLEdBQ3RDLENBQUMsbUNBQW1DLEVBQUV2QixTQUFTdUIsYUFBYSxDQUFDLENBQUMsR0FDOUQ7d0JBRUp0QyxZQUFZOzRCQUNWLEdBQUdBLFNBQVM7NEJBQ1pHLE1BQU1sRixTQUFTa0YsU0FBUzs0QkFDeEJDOzRCQUNBQzs0QkFDQUM7NEJBQ0FDOzRCQUNBaEM7NEJBQ0FpQzs0QkFDQUM7NEJBQ0FDOzRCQUNBQyxTQUFTSSxTQUFTSixPQUFPOzRCQUN6QkMsYUFBYUcsU0FBU00sWUFBWTs0QkFDbENwRTt3QkFDRjtvQkFDRjtnQkFDRjtnQkFFQXhELFFBQVFDLEdBQUcsQ0FBQyxxQkFBcUJzRztnQkFDakMsT0FBT0E7WUFDVCxFQUFFLE9BQU85RixPQUFPO2dCQUNkVCxRQUFRUyxLQUFLLENBQUMsMkJBQTJCa0MsV0FBV2xDO2dCQUNwRCxPQUFPO29CQUNMaUYsSUFBSWpELFFBQVE7b0JBQ1pZLE9BQU9BLE1BQU1tRCxNQUFNLENBQUMsR0FBR0MsV0FBVyxLQUFLcEQsTUFBTWlELEtBQUssQ0FBQztvQkFDbkRJLE1BQU07b0JBQ05DLFVBQVU7b0JBQ1ZDLHFCQUFxQjtvQkFDckJDLFdBQVc7b0JBQ1hDLGFBQWE7b0JBQ2JoQyxRQUFRO29CQUNSaUMsUUFBUSxFQUFFO29CQUNWQyxNQUFNLEVBQUU7b0JBQ1JDLGFBQWE7b0JBQ2JDLFNBQVM7b0JBQ1RDLGFBQWE7b0JBQ2IzRCxRQUFRO29CQUNSYjtvQkFDQW1CLFNBQVMsRUFBRTtnQkFDYjtZQUNGO1FBQ0Y7UUFFQSxNQUFNZ0YsY0FBY3pHLE9BQU80RCxNQUFNLENBQUM4QyxDQUFBQSxRQUFTQSxVQUFVO1FBQ3JELE1BQU1DLGVBQWVwSCxNQUFNQyxJQUFJLENBQUMsSUFBSW9ILElBQUlILFlBQVl2RyxHQUFHLENBQUN3RyxDQUFBQSxRQUFTO2dCQUFDQSxNQUFNMUYsS0FBSztnQkFBRTBGO2FBQU0sR0FBR0csTUFBTTtRQUU5RmxKLFFBQVFDLEdBQUcsQ0FBQyx1QkFBdUIrSSxhQUFhekcsR0FBRyxDQUFDNEcsQ0FBQUEsSUFBTTtnQkFBRTlGLE9BQU84RixFQUFFOUYsS0FBSztnQkFBRStGLE1BQU1ELEVBQUV4RyxTQUFTO1lBQUM7UUFDOUYsT0FBTzFELHFEQUFZQSxDQUFDbUQsSUFBSSxDQUFDNEc7SUFFM0IsRUFBRSxPQUFPdkksT0FBTztRQUNkVCxRQUFRUyxLQUFLLENBQUMsdUJBQXVCQTtRQUNyQyxPQUFPeEIscURBQVlBLENBQUNtRCxJQUFJLENBQ3RCO1lBQUUzQixPQUFPQSxNQUFNNEksT0FBTyxJQUFJO1FBQStCLEdBQ3pEO1lBQUUzSSxRQUFRO1FBQUk7SUFFbEI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL25leHRmbGl4Ly4vc3JjL2FwcC9hcGkvbW92aWVzL3JvdXRlLmpzPzczMzkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgSlNET00gfSBmcm9tICdqc2RvbSc7XG5cbmFzeW5jIGZ1bmN0aW9uIGZldGNoQWxsUGFnZXMobGlzdFVybCkge1xuICBjb25zdCBhbGxNb3ZpZXMgPSBbXTtcbiAgbGV0IGN1cnJlbnRQYWdlID0gMTtcbiAgbGV0IGhhc05leHRQYWdlID0gdHJ1ZTtcbiAgbGV0IHJldHJ5Q291bnQgPSAwO1xuICBjb25zdCBtYXhSZXRyaWVzID0gMjtcbiAgY29uc3QgZGVsYXlCZXR3ZWVuUGFnZXMgPSAyMDAwO1xuICBjb25zdCBkZWxheUJldHdlZW5SZXRyaWVzID0gMzAwMDtcblxuICAvLyBDaGVjayBpZiBpdCdzIGEgd2F0Y2hsaXN0IFVSTFxuICBjb25zdCBpc1dhdGNobGlzdCA9IGxpc3RVcmwuaW5jbHVkZXMoJy93YXRjaGxpc3QnKTtcbiAgXG4gIHdoaWxlIChoYXNOZXh0UGFnZSkge1xuICAgIC8vIEhhbmRsZSBwYWdpbmF0aW9uIFVSTCBmb3JtYXQgZGlmZmVyZW50bHkgZm9yIHdhdGNobGlzdHNcbiAgICBjb25zdCBwYWdlVXJsID0gY3VycmVudFBhZ2UgPT09IDEgXG4gICAgICA/IGxpc3RVcmwgXG4gICAgICA6IGlzV2F0Y2hsaXN0IFxuICAgICAgICA/IGAke2xpc3RVcmwucmVwbGFjZSgvXFwvJC8sICcnKX0vcGFnZS8ke2N1cnJlbnRQYWdlfS9gXG4gICAgICAgIDogYCR7bGlzdFVybH1wYWdlLyR7Y3VycmVudFBhZ2V9L2A7XG4gICAgXG4gICAgY29uc29sZS5sb2coJ0ZldGNoaW5nIHBhZ2U6JywgcGFnZVVybCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGlmIChjdXJyZW50UGFnZSA+IDEpIHtcbiAgICAgICAgY29uc29sZS5sb2coYFdhaXRpbmcgJHtkZWxheUJldHdlZW5QYWdlc31tcyBiZWZvcmUgZmV0Y2hpbmcgbmV4dCBwYWdlLi4uYCk7XG4gICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBkZWxheUJldHdlZW5QYWdlcykpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHBhZ2VVcmwsIHtcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdVc2VyLUFnZW50JzogJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS85MS4wLjQ0NzIuMTI0IFNhZmFyaS81MzcuMzYnLFxuICAgICAgICAgICdBY2NlcHQnOiAndGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsaWNhdGlvbi94bWw7cT0wLjksaW1hZ2Uvd2VicCwqLyo7cT0wLjgnLFxuICAgICAgICAgICdBY2NlcHQtTGFuZ3VhZ2UnOiAnZW4tVVMsZW47cT0wLjUnLFxuICAgICAgICAgICdDb25uZWN0aW9uJzogJ2tlZXAtYWxpdmUnLFxuICAgICAgICAgICdVcGdyYWRlLUluc2VjdXJlLVJlcXVlc3RzJzogJzEnLFxuICAgICAgICAgICdDYWNoZS1Db250cm9sJzogJ21heC1hZ2U9MCdcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGZldGNoIHBhZ2U6JywgcGFnZVVybCwgcmVzcG9uc2Uuc3RhdHVzKTtcbiAgICAgICAgaWYgKHJldHJ5Q291bnQgPCBtYXhSZXRyaWVzKSB7XG4gICAgICAgICAgcmV0cnlDb3VudCsrO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBSZXRyeWluZyBwYWdlICR7Y3VycmVudFBhZ2V9IChhdHRlbXB0ICR7cmV0cnlDb3VudH0vJHttYXhSZXRyaWVzfSlgKTtcbiAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgZGVsYXlCZXR3ZWVuUmV0cmllcykpO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKCdNYXggcmV0cmllcyByZWFjaGVkLCBjb250aW51aW5nIHdpdGggYXZhaWxhYmxlIG1vdmllcycpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgcmV0cnlDb3VudCA9IDA7XG4gICAgICBjb25zdCBodG1sID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuICAgICAgY29uc3QgZG9tID0gbmV3IEpTRE9NKGh0bWwpO1xuICAgICAgY29uc3QgZG9jID0gZG9tLndpbmRvdy5kb2N1bWVudDtcblxuICAgICAgLy8gVHJ5IGRpZmZlcmVudCBzZWxlY3RvcnMgZm9yIG1vdmllIGVsZW1lbnRzXG4gICAgICBjb25zdCBtb3ZpZUVsZW1lbnRzID0gZG9jLnF1ZXJ5U2VsZWN0b3JBbGwoJy5wb3N0ZXItY29udGFpbmVyLCAuZmlsbS1wb3N0ZXInKTtcbiAgICAgIGNvbnNvbGUubG9nKGBGb3VuZCAke21vdmllRWxlbWVudHMubGVuZ3RofSBtb3ZpZXMgb24gcGFnZSAke2N1cnJlbnRQYWdlfWApO1xuXG4gICAgICBpZiAobW92aWVFbGVtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgY29uc29sZS5sb2coJ05vIG1vdmllcyBmb3VuZCBvbiBwYWdlLCBicmVha2luZyBsb29wJyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiB0aGVyZSdzIGEgbmV4dCBwYWdlIGJ5IGxvb2tpbmcgYXQgdGhlIHBhZ2luYXRpb25cbiAgICAgIGNvbnN0IHBhZ2luYXRpb24gPSBkb2MucXVlcnlTZWxlY3RvcignLnBhZ2luYXRlLXBhZ2VzLCAucGFnaW5hdGlvbicpO1xuICAgICAgY29uc29sZS5sb2coJ1BhZ2luYXRpb24gZWxlbWVudCBmb3VuZDonLCAhIXBhZ2luYXRpb24pO1xuICAgICAgXG4gICAgICBpZiAocGFnaW5hdGlvbikge1xuICAgICAgICBjb25zdCBsYXN0UGFnZUxpbmsgPSBwYWdpbmF0aW9uLnF1ZXJ5U2VsZWN0b3IoJ2xpOmxhc3QtY2hpbGQgYSwgLnBhZ2luYXRlLWxhc3QgYScpO1xuICAgICAgICBjb25zdCB0b3RhbFBhZ2VzID0gbGFzdFBhZ2VMaW5rID8gcGFyc2VJbnQobGFzdFBhZ2VMaW5rLnRleHRDb250ZW50KSA6IDE7XG4gICAgICAgIGNvbnNvbGUubG9nKGBUb3RhbCBwYWdlcyBmb3VuZDogJHt0b3RhbFBhZ2VzfWApO1xuICAgICAgICBoYXNOZXh0UGFnZSA9IGN1cnJlbnRQYWdlIDwgdG90YWxQYWdlcztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIElmIG5vIHBhZ2luYXRpb24gZm91bmQsIGNoZWNrIGZvciBuZXh0IGJ1dHRvblxuICAgICAgICBjb25zdCBuZXh0QnV0dG9uID0gZG9jLnF1ZXJ5U2VsZWN0b3IoJy5wYWdpbmF0ZS1uZXh0LCAubmV4dCcpO1xuICAgICAgICBjb25zb2xlLmxvZygnTmV4dCBidXR0b24gZm91bmQ6JywgISFuZXh0QnV0dG9uKTtcbiAgICAgICAgaGFzTmV4dFBhZ2UgPSAhIW5leHRCdXR0b247XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEFkZCBhbGwgbW92aWVzIGZyb20gdGhpcyBwYWdlXG4gICAgICBhbGxNb3ZpZXMucHVzaCguLi5BcnJheS5mcm9tKG1vdmllRWxlbWVudHMpKTtcbiAgICAgIGNvbnNvbGUubG9nKGBUb3RhbCBtb3ZpZXMgY29sbGVjdGVkIHNvIGZhcjogJHthbGxNb3ZpZXMubGVuZ3RofWApO1xuICAgICAgXG4gICAgICBpZiAoaGFzTmV4dFBhZ2UpIHtcbiAgICAgICAgY29uc29sZS5sb2coYE1vdmluZyB0byBwYWdlICR7Y3VycmVudFBhZ2UgKyAxfWApO1xuICAgICAgICBjdXJyZW50UGFnZSsrO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBwYWdlOicsIGVycm9yKTtcbiAgICAgIGlmIChyZXRyeUNvdW50IDwgbWF4UmV0cmllcykge1xuICAgICAgICByZXRyeUNvdW50Kys7XG4gICAgICAgIGNvbnNvbGUubG9nKGBSZXRyeWluZyBwYWdlICR7Y3VycmVudFBhZ2V9IChhdHRlbXB0ICR7cmV0cnlDb3VudH0vJHttYXhSZXRyaWVzfSlgKTtcbiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIGRlbGF5QmV0d2VlblJldHJpZXMpKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBjb25zb2xlLmxvZygnTWF4IHJldHJpZXMgcmVhY2hlZCwgY29udGludWluZyB3aXRoIGF2YWlsYWJsZSBtb3ZpZXMnKTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIGNvbnNvbGUubG9nKGBGaW5pc2hlZCBmZXRjaGluZyBhbGwgcGFnZXMuIFRvdGFsIG1vdmllcyBmb3VuZDogJHthbGxNb3ZpZXMubGVuZ3RofWApO1xuICByZXR1cm4gYWxsTW92aWVzO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7XG4gICAgY29uc3QgbGlzdFVybCA9IHNlYXJjaFBhcmFtcy5nZXQoJ3VybCcpO1xuXG4gICAgaWYgKCFsaXN0VXJsKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdQbGVhc2UgcHJvdmlkZSBhIExldHRlcmJveGQgbGlzdCBVUkwnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygnRmV0Y2hpbmcgbGlzdDonLCBsaXN0VXJsKTtcbiAgICBcbiAgICBjb25zdCBtb3ZpZUVsZW1lbnRzID0gYXdhaXQgZmV0Y2hBbGxQYWdlcyhsaXN0VXJsKTtcbiAgICBjb25zb2xlLmxvZygnVG90YWwgbW92aWUgZWxlbWVudHMgZm91bmQgYWNyb3NzIGFsbCBwYWdlczonLCBtb3ZpZUVsZW1lbnRzLmxlbmd0aCk7XG5cbiAgICBpZiAobW92aWVFbGVtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ05vIG1vdmllcyBmb3VuZCBpbiB0aGUgbGlzdC4gUGxlYXNlIG1ha2Ugc3VyZSB0aGUgbGlzdCBpcyBwdWJsaWMgYW5kIGFjY2Vzc2libGUuJyB9LFxuICAgICAgICB7IHN0YXR1czogNDA0IH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgbW92aWVzID0gYXdhaXQgUHJvbWlzZS5hbGwobW92aWVFbGVtZW50cy5tYXAoYXN5bmMgKGVsZW1lbnQsIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBtb3ZpZUxpbmsgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2RpdltkYXRhLXRhcmdldC1saW5rXScpO1xuICAgICAgY29uc3QgbW92aWVTbHVnID0gbW92aWVMaW5rPy5nZXRBdHRyaWJ1dGUoJ2RhdGEtdGFyZ2V0LWxpbmsnKT8uc3BsaXQoJy8nKVsyXSB8fCAnJztcbiAgICAgIFxuICAgICAgaWYgKCFtb3ZpZVNsdWcpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ05vIG1vdmllIHNsdWcgZm91bmQgZm9yIGVsZW1lbnQ6JywgZWxlbWVudC5vdXRlckhUTUwpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coJ1Byb2Nlc3NpbmcgbW92aWUgd2l0aCBzbHVnOicsIG1vdmllU2x1Zyk7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG1vdmllVXJsID0gYGh0dHBzOi8vbGV0dGVyYm94ZC5jb20vZmlsbS8ke21vdmllU2x1Z30vYDtcbiAgICAgICAgY29uc29sZS5sb2coJ0ZldGNoaW5nIG1vdmllOicsIG1vdmllVXJsKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IG1vdmllUmVzcG9uc2UgPSBhd2FpdCBmZXRjaChtb3ZpZVVybCwge1xuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdVc2VyLUFnZW50JzogJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS85MS4wLjQ0NzIuMTI0IFNhZmFyaS81MzcuMzYnLFxuICAgICAgICAgICAgJ0FjY2VwdCc6ICd0ZXh0L2h0bWwsYXBwbGljYXRpb24veGh0bWwreG1sLGFwcGxpY2F0aW9uL3htbDtxPTAuOSxpbWFnZS93ZWJwLCovKjtxPTAuOCcsXG4gICAgICAgICAgICAnQWNjZXB0LUxhbmd1YWdlJzogJ2VuLVVTLGVuO3E9MC41JyxcbiAgICAgICAgICAgICdDb25uZWN0aW9uJzogJ2tlZXAtYWxpdmUnLFxuICAgICAgICAgICAgJ1VwZ3JhZGUtSW5zZWN1cmUtUmVxdWVzdHMnOiAnMScsXG4gICAgICAgICAgICAnQ2FjaGUtQ29udHJvbCc6ICdtYXgtYWdlPTAnXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIW1vdmllUmVzcG9uc2Uub2spIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gZmV0Y2ggbW92aWU6JywgbW92aWVVcmwsIG1vdmllUmVzcG9uc2Uuc3RhdHVzKTtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG1vdmllSHRtbCA9IGF3YWl0IG1vdmllUmVzcG9uc2UudGV4dCgpO1xuICAgICAgICBjb25zdCBtb3ZpZURvbSA9IG5ldyBKU0RPTShtb3ZpZUh0bWwpO1xuICAgICAgICBjb25zdCBtb3ZpZURvYyA9IG1vdmllRG9tLndpbmRvdy5kb2N1bWVudDtcblxuICAgICAgICBjb25zdCB0aXRsZUVsZW1lbnQgPSBtb3ZpZURvYy5xdWVyeVNlbGVjdG9yKCdoMS5oZWFkbGluZS0xJyk7XG4gICAgICAgIGNvbnN0IHRpdGxlID0gdGl0bGVFbGVtZW50Py50ZXh0Q29udGVudD8udHJpbSgpIHx8IG1vdmllU2x1Zy5yZXBsYWNlKC8tL2csICcgJyk7XG5cbiAgICAgICAgY29uc3QgdG1kYkxpbmsgPSBtb3ZpZURvYy5xdWVyeVNlbGVjdG9yKCdhW2hyZWYqPVwidGhlbW92aWVkYi5vcmdcIl0nKTtcbiAgICAgICAgY29uc3QgdG1kYklkID0gdG1kYkxpbms/LmhyZWY/Lm1hdGNoKC9tb3ZpZVxcLyhcXGQrKS8pPy5bMV07XG5cbiAgICAgICAgY29uc29sZS5sb2coJ01vdmllIHByb2Nlc3Npbmc6Jywge1xuICAgICAgICAgIHRpdGxlLFxuICAgICAgICAgIHRtZGJJZCxcbiAgICAgICAgICBoYXNUbWRiTGluazogISF0bWRiTGluayxcbiAgICAgICAgICB0bWRiTGlua0hyZWY6IHRtZGJMaW5rPy5ocmVmXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGxldHRlcmJveGRBcGlVcmwgPSBgaHR0cHM6Ly9sZXR0ZXJib3hkLmNvbS9maWxtLyR7bW92aWVTbHVnfS9gO1xuICAgICAgICBjb25zb2xlLmxvZygnRmV0Y2hpbmcgcmV2aWV3cyBmcm9tOicsIGxldHRlcmJveGRBcGlVcmwpO1xuICAgICAgICBcbiAgICAgICAgbGV0IHJldmlld3MgPSBbXTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCByZXZpZXdzUmVzcG9uc2UgPSBhd2FpdCBmZXRjaChsZXR0ZXJib3hkQXBpVXJsLCB7XG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICdVc2VyLUFnZW50JzogJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS85MS4wLjQ0NzIuMTI0IFNhZmFyaS81MzcuMzYnLFxuICAgICAgICAgICAgICAnQWNjZXB0JzogJ3RleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LGltYWdlL3dlYnAsKi8qO3E9MC44JyxcbiAgICAgICAgICAgICAgJ0FjY2VwdC1MYW5ndWFnZSc6ICdlbi1VUyxlbjtxPTAuNScsXG4gICAgICAgICAgICAgICdDb25uZWN0aW9uJzogJ2tlZXAtYWxpdmUnLFxuICAgICAgICAgICAgICAnVXBncmFkZS1JbnNlY3VyZS1SZXF1ZXN0cyc6ICcxJyxcbiAgICAgICAgICAgICAgJ0NhY2hlLUNvbnRyb2wnOiAnbWF4LWFnZT0wJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgY29uc29sZS5sb2coJ1Jldmlld3MgcmVzcG9uc2Ugc3RhdHVzOicsIHJldmlld3NSZXNwb25zZS5zdGF0dXMpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXZpZXdzIHJlc3BvbnNlIG9rOicsIHJldmlld3NSZXNwb25zZS5vayk7XG5cbiAgICAgICAgICBpZiAocmV2aWV3c1Jlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICBjb25zdCByZXZpZXdzSHRtbCA9IGF3YWl0IHJldmlld3NSZXNwb25zZS50ZXh0KCk7XG4gICAgICAgICAgICBjb25zdCByZXZpZXdzRG9tID0gbmV3IEpTRE9NKHJldmlld3NIdG1sKTtcbiAgICAgICAgICAgIGNvbnN0IHJldmlld3NEb2MgPSByZXZpZXdzRG9tLndpbmRvdy5kb2N1bWVudDtcblxuICAgICAgICAgICAgLy8gRmluZCB0aGUgUG9wdWxhciBSZXZpZXdzIHNlY3Rpb24gYW5kIGdldCBpdHMgQUpBWCBVUkxcbiAgICAgICAgICAgIGNvbnN0IHBvcHVsYXJSZXZpZXdzU2VjdGlvbiA9IHJldmlld3NEb2MucXVlcnlTZWxlY3RvcignLmpzLXBvcHVsYXItcmV2aWV3cycpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1BvcHVsYXIgcmV2aWV3cyBzZWN0aW9uIGZvdW5kOicsICEhcG9wdWxhclJldmlld3NTZWN0aW9uKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHBvcHVsYXJSZXZpZXdzU2VjdGlvbikge1xuICAgICAgICAgICAgICBjb25zdCByZXZpZXdzVXJsID0gcG9wdWxhclJldmlld3NTZWN0aW9uLmdldEF0dHJpYnV0ZSgnZGF0YS11cmwnKTtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZvdW5kIHJldmlld3MgVVJMOicsIHJldmlld3NVcmwpO1xuXG4gICAgICAgICAgICAgIGlmIChyZXZpZXdzVXJsKSB7XG4gICAgICAgICAgICAgICAgLy8gRmV0Y2ggdGhlIHJldmlld3MgZnJvbSB0aGUgQUpBWCBlbmRwb2ludFxuICAgICAgICAgICAgICAgIGNvbnN0IGFqYXhSZXZpZXdzUmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgaHR0cHM6Ly9sZXR0ZXJib3hkLmNvbSR7cmV2aWV3c1VybH1gLCB7XG4gICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICdVc2VyLUFnZW50JzogJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS85MS4wLjQ0NzIuMTI0IFNhZmFyaS81MzcuMzYnLFxuICAgICAgICAgICAgICAgICAgICAnQWNjZXB0JzogJ3RleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LGltYWdlL3dlYnAsKi8qO3E9MC44JyxcbiAgICAgICAgICAgICAgICAgICAgJ0FjY2VwdC1MYW5ndWFnZSc6ICdlbi1VUyxlbjtxPTAuNScsXG4gICAgICAgICAgICAgICAgICAgICdDb25uZWN0aW9uJzogJ2tlZXAtYWxpdmUnLFxuICAgICAgICAgICAgICAgICAgICAnWC1SZXF1ZXN0ZWQtV2l0aCc6ICdYTUxIdHRwUmVxdWVzdCdcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmIChhamF4UmV2aWV3c1Jlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICAgICAgICBjb25zdCBhamF4UmV2aWV3c0h0bWwgPSBhd2FpdCBhamF4UmV2aWV3c1Jlc3BvbnNlLnRleHQoKTtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IGFqYXhSZXZpZXdzRG9tID0gbmV3IEpTRE9NKGFqYXhSZXZpZXdzSHRtbCk7XG4gICAgICAgICAgICAgICAgICBjb25zdCBhamF4UmV2aWV3c0RvYyA9IGFqYXhSZXZpZXdzRG9tLndpbmRvdy5kb2N1bWVudDtcblxuICAgICAgICAgICAgICAgICAgY29uc3QgcmV2aWV3Q29udGFpbmVycyA9IGFqYXhSZXZpZXdzRG9jLnF1ZXJ5U2VsZWN0b3JBbGwoJy5qcy1saXN0aXRlbScpO1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZvdW5kIHJldmlldyBjb250YWluZXJzOicsIHJldmlld0NvbnRhaW5lcnMubGVuZ3RoKTtcblxuICAgICAgICAgICAgICAgICAgaWYgKHJldmlld0NvbnRhaW5lcnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXZpZXdzID0gQXJyYXkuZnJvbShyZXZpZXdDb250YWluZXJzKVxuICAgICAgICAgICAgICAgICAgICAgIC5tYXAoY29udGFpbmVyID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJldmlld1RleHQgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmpzLXJldmlldy1ib2R5Jyk/LnRleHRDb250ZW50Py50cmltKCkgfHwgJyc7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXZpZXdlck5hbWUgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmRpc3BsYXluYW1lJyk/LnRleHRDb250ZW50Py50cmltKCkgfHwgJ0Fub255bW91cyc7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByYXRpbmdFbGVtZW50ID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5yYXRpbmcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJhdGluZyA9IHJhdGluZ0VsZW1lbnQgPyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgKHJhdGluZ0VsZW1lbnQudGV4dENvbnRlbnQuaW5jbHVkZXMoJ+KYhScpID8gXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmF0aW5nRWxlbWVudC50ZXh0Q29udGVudC5zcGxpdCgn4piFJykubGVuZ3RoIC0gMSA6IDApIDogMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGVFbGVtZW50ID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ3RpbWUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBkYXRlRWxlbWVudD8uZ2V0QXR0cmlidXRlKCdkYXRldGltZScpIHx8IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGF2YXRhckVsZW1lbnQgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmF2YXRhciBpbWcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGF2YXRhclVybCA9IGF2YXRhckVsZW1lbnQ/LnNyYyB8fCBudWxsO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUHJvY2Vzc2luZyByZXZpZXc6Jywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICByZXZpZXdlcjogcmV2aWV3ZXJOYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNDb250ZW50OiAhIXJldmlld1RleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRMZW5ndGg6IHJldmlld1RleHQubGVuZ3RoLFxuICAgICAgICAgICAgICAgICAgICAgICAgICByYXRpbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGhhc0F2YXRhcjogISFhdmF0YXJVcmxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogY29udGFpbmVyPy5xdWVyeVNlbGVjdG9yKCcuanMtcHJvZHVjdGlvbi12aWV3aW5nJyk/LmdldEF0dHJpYnV0ZSgnZGF0YS12aWV3aW5nLWlkJykgfHwgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICByZXZpZXdlcjogcmV2aWV3ZXJOYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICByYXRpbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHJldmlld1RleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHByb2ZpbGVQYXRoOiBhdmF0YXJVcmxcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKHJldmlldyA9PiByZXZpZXcuY29udGVudC5sZW5ndGggPiAwKTtcblxuICAgICAgICAgICAgICAgICAgICByZXZpZXdzLnNvcnQoKGEsIGIpID0+IG5ldyBEYXRlKGIuZGF0ZSkgLSBuZXcgRGF0ZShhLmRhdGUpKTtcbiAgICAgICAgICAgICAgICAgICAgcmV2aWV3cyA9IHJldmlld3Muc2xpY2UoMCwgNik7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGaW5hbCBwcm9jZXNzZWQgcmV2aWV3czonLCByZXZpZXdzLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHJldmlld3M6JywgZXJyb3IpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IG1vdmllRGF0YSA9IHtcbiAgICAgICAgICBpZDogaW5kZXggKyAxLFxuICAgICAgICAgIHRpdGxlOiB0aXRsZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRpdGxlLnNsaWNlKDEpLFxuICAgICAgICAgIHllYXI6IG51bGwsXG4gICAgICAgICAgZGlyZWN0b3I6ICdVbmtub3duIERpcmVjdG9yJyxcbiAgICAgICAgICBkaXJlY3RvclByb2ZpbGVQYXRoOiBudWxsLFxuICAgICAgICAgIHBvc3RlclVybDogJ2h0dHBzOi8vcy5sdHJieGQuY29tL3N0YXRpYy9pbWcvZW1wdHktcG9zdGVyLTEwMDAtRDljcHJ2MG0ucG5nJyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ05vIGRlc2NyaXB0aW9uIGF2YWlsYWJsZScsXG4gICAgICAgICAgcmF0aW5nOiBudWxsLFxuICAgICAgICAgIGdlbnJlczogW10sXG4gICAgICAgICAgY2FzdDogW10sXG4gICAgICAgICAgYmFja2Ryb3BVcmw6IG51bGwsXG4gICAgICAgICAgcnVudGltZTogbnVsbCxcbiAgICAgICAgICByZWxlYXNlRGF0ZTogbnVsbCxcbiAgICAgICAgICB0bWRiSWQ6IG51bGwsXG4gICAgICAgICAgbW92aWVTbHVnLFxuICAgICAgICAgIHJldmlld3M6IHJldmlld3MgfHwgW11cbiAgICAgICAgfTtcblxuICAgICAgICBpZiAodG1kYklkKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ0ZldGNoaW5nIGRhdGEgZm9yIG1vdmllIHdpdGggVE1EQiBJRDonLCB0bWRiSWQpO1xuICAgICAgICAgIFxuICAgICAgICAgIGNvbnN0IHRtZGJVcmwgPSBgaHR0cHM6Ly9hcGkudGhlbW92aWVkYi5vcmcvMy9tb3ZpZS8ke3RtZGJJZH0/YXBpX2tleT0yZGNhNTgwYzJhMTRiNTUyMDBlNzg0ZDE1NzIwN2I0ZCZhcHBlbmRfdG9fcmVzcG9uc2U9Y3JlZGl0c2A7XG4gICAgICAgICAgY29uc29sZS5sb2coJ0ZldGNoaW5nIG1vdmllIGRldGFpbHMgZnJvbTonLCB0bWRiVXJsKTtcbiAgICAgICAgICBcbiAgICAgICAgICBjb25zdCB0bWRiUmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh0bWRiVXJsLCB7XG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGlmICh0bWRiUmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgIGNvbnN0IHRtZGJEYXRhID0gYXdhaXQgdG1kYlJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUTURCIG1vdmllIGRhdGEgcmVjZWl2ZWQ6Jywge1xuICAgICAgICAgICAgICB0aXRsZTogdG1kYkRhdGEudGl0bGUsXG4gICAgICAgICAgICAgIGhhc0NyZWRpdHM6ICEhdG1kYkRhdGEuY3JlZGl0cyxcbiAgICAgICAgICAgICAgcmVzcG9uc2VLZXlzOiBPYmplY3Qua2V5cyh0bWRiRGF0YSlcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCB5ZWFyID0gdG1kYkRhdGEucmVsZWFzZV9kYXRlPy5zcGxpdCgnLScpWzBdIHx8ICcnO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBkaXJlY3RvckRhdGEgPSB0bWRiRGF0YS5jcmVkaXRzPy5jcmV3Py5maW5kKHBlcnNvbiA9PiBwZXJzb24uam9iID09PSAnRGlyZWN0b3InKTtcbiAgICAgICAgICAgIGNvbnN0IGRpcmVjdG9yID0gZGlyZWN0b3JEYXRhPy5uYW1lIHx8ICdVbmtub3duIERpcmVjdG9yJztcbiAgICAgICAgICAgIGNvbnN0IGRpcmVjdG9yUHJvZmlsZVBhdGggPSBkaXJlY3RvckRhdGE/LnByb2ZpbGVfcGF0aCBcbiAgICAgICAgICAgICAgPyBgaHR0cHM6Ly9pbWFnZS50bWRiLm9yZy90L3AvdzE4NSR7ZGlyZWN0b3JEYXRhLnByb2ZpbGVfcGF0aH1gXG4gICAgICAgICAgICAgIDogbnVsbDtcblxuICAgICAgICAgICAgY29uc3QgY2FzdCA9IHRtZGJEYXRhLmNyZWRpdHM/LmNhc3RcbiAgICAgICAgICAgICAgPy5tYXAoYWN0b3IgPT4gKHtcbiAgICAgICAgICAgICAgICBuYW1lOiBhY3Rvci5uYW1lLFxuICAgICAgICAgICAgICAgIGNoYXJhY3RlcjogYWN0b3IuY2hhcmFjdGVyLFxuICAgICAgICAgICAgICAgIHByb2ZpbGVQYXRoOiBhY3Rvci5wcm9maWxlX3BhdGggXG4gICAgICAgICAgICAgICAgICA/IGBodHRwczovL2ltYWdlLnRtZGIub3JnL3QvcC93MTg1JHthY3Rvci5wcm9maWxlX3BhdGh9YFxuICAgICAgICAgICAgICAgICAgOiBudWxsLFxuICAgICAgICAgICAgICAgIG9yZGVyOiBhY3Rvci5vcmRlclxuICAgICAgICAgICAgICB9KSlcbiAgICAgICAgICAgICAgLnNvcnQoKGEsIGIpID0+IGEub3JkZXIgLSBiLm9yZGVyKSB8fCBbXTtcblxuICAgICAgICAgICAgbGV0IGRlc2NyaXB0aW9uID0gJ05vIGRlc2NyaXB0aW9uIGF2YWlsYWJsZSc7XG4gICAgICAgICAgICBpZiAodG1kYkRhdGEub3ZlcnZpZXcpIHtcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb24gPSB0bWRiRGF0YS5vdmVydmlldztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNvbnN0IGxldHRlcmJveGREZXNjcmlwdGlvbiA9IG1vdmllRG9jLnF1ZXJ5U2VsZWN0b3IoJy50ZXh0LXNsdWdsaXN0ICsgcCwgLnRleHQtc2x1Z2xpc3QgKyBkaXYgcCcpO1xuICAgICAgICAgICAgICBpZiAobGV0dGVyYm94ZERlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gPSBsZXR0ZXJib3hkRGVzY3JpcHRpb24udGV4dENvbnRlbnQudHJpbSgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHJhdGluZyA9IHRtZGJEYXRhLnZvdGVfYXZlcmFnZSBcbiAgICAgICAgICAgICAgPyBNYXRoLnJvdW5kKHRtZGJEYXRhLnZvdGVfYXZlcmFnZSAqIDEwKSAvIDEwIFxuICAgICAgICAgICAgICA6IG51bGw7XG5cbiAgICAgICAgICAgIGNvbnN0IGdlbnJlcyA9IHRtZGJEYXRhLmdlbnJlcz8ubWFwKGdlbnJlID0+IGdlbnJlLm5hbWUpIHx8IFtdO1xuXG4gICAgICAgICAgICBjb25zdCBwb3N0ZXJVcmwgPSB0bWRiRGF0YS5wb3N0ZXJfcGF0aCBcbiAgICAgICAgICAgICAgPyBgaHR0cHM6Ly9pbWFnZS50bWRiLm9yZy90L3AvdzUwMCR7dG1kYkRhdGEucG9zdGVyX3BhdGh9YFxuICAgICAgICAgICAgICA6ICdodHRwczovL3MubHRyYnhkLmNvbS9zdGF0aWMvaW1nL2VtcHR5LXBvc3Rlci0xMDAwLUQ5Y3BydjBtLnBuZyc7XG5cbiAgICAgICAgICAgIGNvbnN0IGJhY2tkcm9wVXJsID0gdG1kYkRhdGEuYmFja2Ryb3BfcGF0aFxuICAgICAgICAgICAgICA/IGBodHRwczovL2ltYWdlLnRtZGIub3JnL3QvcC9vcmlnaW5hbCR7dG1kYkRhdGEuYmFja2Ryb3BfcGF0aH1gXG4gICAgICAgICAgICAgIDogbnVsbDtcblxuICAgICAgICAgICAgbW92aWVEYXRhID0ge1xuICAgICAgICAgICAgICAuLi5tb3ZpZURhdGEsXG4gICAgICAgICAgICAgIHllYXI6IHBhcnNlSW50KHllYXIpIHx8IG51bGwsXG4gICAgICAgICAgICAgIGRpcmVjdG9yLFxuICAgICAgICAgICAgICBkaXJlY3RvclByb2ZpbGVQYXRoLFxuICAgICAgICAgICAgICBwb3N0ZXJVcmwsXG4gICAgICAgICAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICByYXRpbmcsXG4gICAgICAgICAgICAgIGdlbnJlcyxcbiAgICAgICAgICAgICAgY2FzdCxcbiAgICAgICAgICAgICAgYmFja2Ryb3BVcmwsXG4gICAgICAgICAgICAgIHJ1bnRpbWU6IHRtZGJEYXRhLnJ1bnRpbWUsXG4gICAgICAgICAgICAgIHJlbGVhc2VEYXRlOiB0bWRiRGF0YS5yZWxlYXNlX2RhdGUsXG4gICAgICAgICAgICAgIHRtZGJJZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zb2xlLmxvZygnRmluYWwgbW92aWUgZGF0YTonLCBtb3ZpZURhdGEpO1xuICAgICAgICByZXR1cm4gbW92aWVEYXRhO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcHJvY2Vzc2luZyBtb3ZpZTonLCBtb3ZpZVNsdWcsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBpZDogaW5kZXggKyAxLFxuICAgICAgICAgIHRpdGxlOiB0aXRsZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRpdGxlLnNsaWNlKDEpLFxuICAgICAgICAgIHllYXI6IG51bGwsXG4gICAgICAgICAgZGlyZWN0b3I6ICdVbmtub3duIERpcmVjdG9yJyxcbiAgICAgICAgICBkaXJlY3RvclByb2ZpbGVQYXRoOiBudWxsLFxuICAgICAgICAgIHBvc3RlclVybDogJ2h0dHBzOi8vcy5sdHJieGQuY29tL3N0YXRpYy9pbWcvZW1wdHktcG9zdGVyLTEwMDAtRDljcHJ2MG0ucG5nJyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ05vIGRlc2NyaXB0aW9uIGF2YWlsYWJsZScsXG4gICAgICAgICAgcmF0aW5nOiBudWxsLFxuICAgICAgICAgIGdlbnJlczogW10sXG4gICAgICAgICAgY2FzdDogW10sXG4gICAgICAgICAgYmFja2Ryb3BVcmw6IG51bGwsXG4gICAgICAgICAgcnVudGltZTogbnVsbCxcbiAgICAgICAgICByZWxlYXNlRGF0ZTogbnVsbCxcbiAgICAgICAgICB0bWRiSWQ6IG51bGwsXG4gICAgICAgICAgbW92aWVTbHVnLFxuICAgICAgICAgIHJldmlld3M6IFtdXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSkpO1xuXG4gICAgY29uc3QgdmFsaWRNb3ZpZXMgPSBtb3ZpZXMuZmlsdGVyKG1vdmllID0+IG1vdmllICE9PSBudWxsKTtcbiAgICBjb25zdCB1bmlxdWVNb3ZpZXMgPSBBcnJheS5mcm9tKG5ldyBNYXAodmFsaWRNb3ZpZXMubWFwKG1vdmllID0+IFttb3ZpZS50aXRsZSwgbW92aWVdKSkudmFsdWVzKCkpO1xuXG4gICAgY29uc29sZS5sb2coJ0ZpbmFsIG1vdmllcyBhcnJheTonLCB1bmlxdWVNb3ZpZXMubWFwKG0gPT4gKHsgdGl0bGU6IG0udGl0bGUsIHNsdWc6IG0ubW92aWVTbHVnIH0pKSk7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHVuaXF1ZU1vdmllcyk7XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBBUEkgcm91dGU6JywgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfHwgJ0FuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQnIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59ICJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJKU0RPTSIsImZldGNoQWxsUGFnZXMiLCJsaXN0VXJsIiwiYWxsTW92aWVzIiwiY3VycmVudFBhZ2UiLCJoYXNOZXh0UGFnZSIsInJldHJ5Q291bnQiLCJtYXhSZXRyaWVzIiwiZGVsYXlCZXR3ZWVuUGFnZXMiLCJkZWxheUJldHdlZW5SZXRyaWVzIiwiaXNXYXRjaGxpc3QiLCJpbmNsdWRlcyIsInBhZ2VVcmwiLCJyZXBsYWNlIiwiY29uc29sZSIsImxvZyIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsInJlc3BvbnNlIiwiZmV0Y2giLCJoZWFkZXJzIiwib2siLCJlcnJvciIsInN0YXR1cyIsImh0bWwiLCJ0ZXh0IiwiZG9tIiwiZG9jIiwid2luZG93IiwiZG9jdW1lbnQiLCJtb3ZpZUVsZW1lbnRzIiwicXVlcnlTZWxlY3RvckFsbCIsImxlbmd0aCIsInBhZ2luYXRpb24iLCJxdWVyeVNlbGVjdG9yIiwibGFzdFBhZ2VMaW5rIiwidG90YWxQYWdlcyIsInBhcnNlSW50IiwidGV4dENvbnRlbnQiLCJuZXh0QnV0dG9uIiwicHVzaCIsIkFycmF5IiwiZnJvbSIsIkdFVCIsInJlcXVlc3QiLCJzZWFyY2hQYXJhbXMiLCJVUkwiLCJ1cmwiLCJnZXQiLCJqc29uIiwibW92aWVzIiwiYWxsIiwibWFwIiwiZWxlbWVudCIsImluZGV4IiwibW92aWVMaW5rIiwibW92aWVTbHVnIiwiZ2V0QXR0cmlidXRlIiwic3BsaXQiLCJvdXRlckhUTUwiLCJtb3ZpZVVybCIsIm1vdmllUmVzcG9uc2UiLCJtb3ZpZUh0bWwiLCJtb3ZpZURvbSIsIm1vdmllRG9jIiwidGl0bGVFbGVtZW50IiwidGl0bGUiLCJ0cmltIiwidG1kYkxpbmsiLCJ0bWRiSWQiLCJocmVmIiwibWF0Y2giLCJoYXNUbWRiTGluayIsInRtZGJMaW5rSHJlZiIsImxldHRlcmJveGRBcGlVcmwiLCJyZXZpZXdzIiwicmV2aWV3c1Jlc3BvbnNlIiwicmV2aWV3c0h0bWwiLCJyZXZpZXdzRG9tIiwicmV2aWV3c0RvYyIsInBvcHVsYXJSZXZpZXdzU2VjdGlvbiIsInJldmlld3NVcmwiLCJhamF4UmV2aWV3c1Jlc3BvbnNlIiwiYWpheFJldmlld3NIdG1sIiwiYWpheFJldmlld3NEb20iLCJhamF4UmV2aWV3c0RvYyIsInJldmlld0NvbnRhaW5lcnMiLCJjb250YWluZXIiLCJyZXZpZXdUZXh0IiwicmV2aWV3ZXJOYW1lIiwicmF0aW5nRWxlbWVudCIsInJhdGluZyIsImRhdGVFbGVtZW50IiwiZGF0ZSIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImF2YXRhckVsZW1lbnQiLCJhdmF0YXJVcmwiLCJzcmMiLCJyZXZpZXdlciIsImhhc0NvbnRlbnQiLCJjb250ZW50TGVuZ3RoIiwiaGFzQXZhdGFyIiwiaWQiLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHIiLCJjb250ZW50IiwicHJvZmlsZVBhdGgiLCJmaWx0ZXIiLCJyZXZpZXciLCJzb3J0IiwiYSIsImIiLCJzbGljZSIsIm1vdmllRGF0YSIsImNoYXJBdCIsInRvVXBwZXJDYXNlIiwieWVhciIsImRpcmVjdG9yIiwiZGlyZWN0b3JQcm9maWxlUGF0aCIsInBvc3RlclVybCIsImRlc2NyaXB0aW9uIiwiZ2VucmVzIiwiY2FzdCIsImJhY2tkcm9wVXJsIiwicnVudGltZSIsInJlbGVhc2VEYXRlIiwidG1kYlVybCIsInRtZGJSZXNwb25zZSIsInRtZGJEYXRhIiwiaGFzQ3JlZGl0cyIsImNyZWRpdHMiLCJyZXNwb25zZUtleXMiLCJPYmplY3QiLCJrZXlzIiwicmVsZWFzZV9kYXRlIiwiZGlyZWN0b3JEYXRhIiwiY3JldyIsImZpbmQiLCJwZXJzb24iLCJqb2IiLCJuYW1lIiwicHJvZmlsZV9wYXRoIiwiYWN0b3IiLCJjaGFyYWN0ZXIiLCJvcmRlciIsIm92ZXJ2aWV3IiwibGV0dGVyYm94ZERlc2NyaXB0aW9uIiwidm90ZV9hdmVyYWdlIiwicm91bmQiLCJnZW5yZSIsInBvc3Rlcl9wYXRoIiwiYmFja2Ryb3BfcGF0aCIsInZhbGlkTW92aWVzIiwibW92aWUiLCJ1bmlxdWVNb3ZpZXMiLCJNYXAiLCJ2YWx1ZXMiLCJtIiwic2x1ZyIsIm1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/movies/route.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fmovies%2Froute&page=%2Fapi%2Fmovies%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmovies%2Froute.js&appDir=%2FUsers%2Fguzmancura%2FDesktop%2Fnextflix%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fguzmancura%2FDesktop%2Fnextflix&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();